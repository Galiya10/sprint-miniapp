<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>–°–ø—Ä–∏–Ω—Ç - –¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      padding: 0;
      padding-bottom: 80px;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* –®–∞–ø–∫–∞ —Å –æ—Ç—Å—Ç—É–ø–æ–º –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ Telegram */
    .header {
      padding: max(env(safe-area-inset-top), 20px) 20px 20px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: #0a0a0a;
      z-index: 100;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 800;
      color: #ffffff;
    }

    .balance {
      background: #2a2a2a;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.3s ease;
    }

    .balance.bounce {
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
    .calendar {
      padding: 0 20px 20px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .calendar-week {
      display: flex;
      gap: 12px;
      justify-content: space-between;
    }

    .calendar-day {
      flex: 1;
      min-width: 40px;
      text-align: center;
    }

    .day-name {
      font-size: 12px;
      color: #888;
      margin-bottom: 6px;
      text-transform: lowercase;
    }

    .day-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      margin: 0 auto;
    }

    .day-number.past {
      color: #ffffff;
    }

    .day-number.today {
      color: #ffffff;
      border: 2px solid #a4e34e;
      background: rgba(164, 227, 78, 0.1);
    }

    .day-number.future {
      color: #555;
    }

    /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø—Ä–∏–≤—ã—á–∫–∏ */
    .content {
      padding: 0 20px;
    }

    .category {
      margin-bottom: 30px;
    }

    .category-title {
      font-size: 18px;
      font-weight: 600;
      color: #888;
      margin-bottom: 12px;
    }

    .habit-card {
      background: #1a1a1a;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .habit-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 16px;
      padding: 2px;
      background: var(--habit-color, #4CAF50);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }

    .habit-icon {
      font-size: 32px;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #2a2a2a;
      border-radius: 50%;
    }

    .habit-info {
      flex: 1;
    }

    .habit-name {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .habit-reward {
      font-size: 14px;
      color: #888;
    }

    .habit-check {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #2a2a2a;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #555;
      transition: all 0.2s ease;
    }

    .habit-check:active {
      transform: scale(1.2);
    }

    .habit-check.completed {
      background: var(--habit-color, #4CAF50);
      color: #ffffff;
    }

    /* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
    .add-habit-btn {
      width: 100%;
      padding: 16px;
      background: #2a2a2a;
      border: 2px dashed #444;
      border-radius: 16px;
      color: #888;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      transition: all 0.2s ease;
    }

    .add-habit-btn:active {
      background: #333;
    }

    /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #0a0a0a;
      border-top: 1px solid #2a2a2a;
      display: flex;
      justify-content: space-around;
      padding: 12px 0 max(env(safe-area-inset-bottom), 12px);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: #555;
      text-decoration: none;
      font-size: 12px;
      font-weight: 600;
      transition: color 0.2s ease;
    }

    .nav-item.active {
      color: #a4e34e;
    }

    .nav-icon {
      font-size: 24px;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –°–ø—Ä–∏–Ω—Ç–∞ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    .modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-card {
      background: #2a2a2a;
      border-radius: 20px;
      padding: 24px;
      max-width: 90%;
      width: 320px;
      position: relative;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #1a1a1a;
      border: none;
      color: #888;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sprint-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .sprint-avatar {
      width: 80px;
      height: 80px;
      margin: 0 auto 12px;
      font-size: 60px;
    }

    .sprint-badge {
      background: #a4e34e;
      color: #0a0a0a;
      padding: 6px 16px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      display: inline-block;
    }

    .sprint-message {
      font-size: 16px;
      line-height: 1.6;
      color: #ddd;
      text-align: center;
    }

    /* –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏ */
    .habit-form {
      display: none;
      margin-bottom: 20px;
      background: #1a1a1a;
      border-radius: 16px;
      padding: 20px;
    }

    .habit-form.show {
      display: block;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #888;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      background: #2a2a2a;
      border: 2px solid #333;
      border-radius: 12px;
      color: #ffffff;
      font-size: 16px;
      font-family: 'Nunito', sans-serif;
    }

    .form-input:focus {
      outline: none;
      border-color: #a4e34e;
    }

    .color-picker {
      display: flex;
      gap: 12px;
    }

    .color-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .color-option.selected {
      border-color: #ffffff;
      transform: scale(1.1);
    }

    .form-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .form-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      transition: all 0.2s ease;
    }

    .form-btn.primary {
      background: #a4e34e;
      color: #0a0a0a;
    }

    .form-btn.secondary {
      background: #2a2a2a;
      color: #888;
    }

    .form-btn:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <!-- –®–∞–ø–∫–∞ -->
  <div class="header">
    <h1>–°–µ–≥–æ–¥–Ω—è</h1>
    <div class="balance" id="balance">
      <span id="balanceAmount">125</span>
      <span>üåº</span>
    </div>
  </div>

  <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <div class="calendar">
    <div class="calendar-week" id="calendar"></div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="content">
    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏ -->
    <div class="habit-form" id="habitForm">
      <div class="form-group">
        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏</label>
        <input type="text" class="form-input" id="habitName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞">
      </div>
      
      <div class="form-group">
        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <input type="text" class="form-input" id="habitCategory" placeholder="–ó–¥–æ—Ä–æ–≤—å–µ, –°–ø–æ—Ä—Ç...">
      </div>
      
      <div class="form-group">
        <label class="form-label">–ù–∞–≥—Ä–∞–¥–∞ (—Ü–≤–µ—Ç–∫–æ–≤)</label>
        <input type="number" class="form-input" id="habitReward" value="5" min="1">
      </div>
      
      <div class="form-group">
        <label class="form-label">–¶–≤–µ—Ç</label>
        <div class="color-picker">
          <div class="color-option selected" style="background: #4CAF50" data-color="#4CAF50"></div>
          <div class="color-option" style="background: #2196F3" data-color="#2196F3"></div>
          <div class="color-option" style="background: #f44336" data-color="#f44336"></div>
          <div class="color-option" style="background: #FFC107" data-color="#FFC107"></div>
          <div class="color-option" style="background: #9C27B0" data-color="#9C27B0"></div>
        </div>
      </div>
      
      <div class="form-buttons">
        <button class="form-btn secondary" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
        <button class="form-btn primary" id="createBtn">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø—Ä–∏–≤—ã—á–µ–∫ -->
    <div id="habitsList"></div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="add-habit-btn" id="addHabitBtn">+ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É</button>
  </div>

  <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="bottom-nav">
    <a href="#" class="nav-item active">
      <div class="nav-icon">üìÖ</div>
      <div>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
    </a>
    <a href="#" class="nav-item">
      <div class="nav-icon">üë§</div>
      <div>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </a>
    <a href="#" class="nav-item">
      <div class="nav-icon">‚öîÔ∏è</div>
      <div>–î—É—ç–ª—å</div>
    </a>
    <a href="#" class="nav-item">
      <div class="nav-icon">üå≥</div>
      <div>–°–∞–¥</div>
    </a>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –°–ø—Ä–∏–Ω—Ç–∞ -->
  <div class="modal" id="sprintModal">
    <div class="modal-card">
      <button class="modal-close" id="closeModal">‚úï</button>
      <div class="sprint-header">
        <div class="sprint-avatar">ü¶•</div>
        <div class="sprint-badge">–°–ø—Ä–∏–Ω—Ç</div>
      </div>
      <p class="sprint-message" id="sprintMessage"></p>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –°–ø—Ä–∏–Ω—Ç–∞
    const sprintMessages = [
      "–≠–π! –¢–≤–æ–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è –≤—è–Ω—É—Ç! üå± –ü–æ–ª–µ–π –∏—Ö —Å–∫–æ—Ä–µ–µ!",
      "–õ–µ–Ω–∏–≤–∏—Ç—å—Å—è —Ö–æ—Ä–æ—à–æ, –Ω–æ –Ω–µ —Å–µ–≥–æ–¥–Ω—è! üí™ –¢–≤–æ–π —Å–∞–¥ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–±–µ!",
      "–°—Ç–æ–ø! –ï—â—ë –æ–¥–∏–Ω –ø—Ä–æ–ø—É—Å–∫ ‚Äî –∏ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–≥–∏–±–Ω–µ—Ç üò¢",
      "–¢–≤–æ–π —Å–∞–¥ –≥—Ä—É—Å—Ç–∏—Ç –±–µ–∑ —Ç–µ–±—è! –î–∞–≤–∞–π –≤–µ—Ä–Ω—ë–º –µ–º—É –∂–∏–∑–Ω—å üåø",
      "–û–≥–æ! –ö–∞–∂–µ—Ç—Å—è, –∫—Ç–æ-—Ç–æ —Ä–µ—à–∏–ª –æ—Ç–¥–æ—Ö–Ω—É—Ç—å? –ù–æ —Ä–∞—Å—Ç–µ–Ω–∏—è –∂–¥—É—Ç! ü¶•‚ú®"
    ];

    // –≠–≤–æ–ª—é—Ü–∏—è —Ä–∞—Å—Ç–µ–Ω–∏–π
    const plantStages = {
      0: 'üåæ',  // —Å–µ–º–µ—á–∫–æ
      1: 'üåæ',
      2: 'üå±',  // —Ä–æ—Å—Ç–æ–∫
      3: 'üåø',  // –∫—É—Å—Ç
      4: 'üåø',
      5: 'üå≥'   // –¥–µ—Ä–µ–≤–æ
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ LocalStorage
    let data = {
      balance: parseInt(localStorage.getItem('balance')) || 125,
      habits: JSON.parse(localStorage.getItem('habits')) || [
        {
          id: 1,
          name: '–°–æ–Ω –ø–æ —Ä–µ–∂–∏–º—É',
          category: '–ó–¥–æ—Ä–æ–≤—å–µ',
          reward: 5,
          color: '#4CAF50',
          streak: 2,
          lastCompleted: null,
          skips: 0,
          weekSkips: 0
        },
        {
          id: 2,
          name: '–ü—Ä–æ–≥—É–ª–∫–∞',
          category: '–°–ø–æ—Ä—Ç',
          reward: 5,
          color: '#2196F3',
          streak: 1,
          lastCompleted: null,
          skips: 0,
          weekSkips: 0
        },
        {
          id: 3,
          name: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
          category: '–°–ø–æ—Ä—Ç',
          reward: 10,
          color: '#f44336',
          streak: 0,
          lastCompleted: null,
          skips: 0,
          weekSkips: 0
        }
      ]
    };

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function saveData() {
      localStorage.setItem('balance', data.balance);
      localStorage.setItem('habits', JSON.stringify(data.habits));
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
    function updateBalance(amount) {
      data.balance += amount;
      const balanceEl = document.getElementById('balanceAmount');
      balanceEl.textContent = data.balance;
      document.getElementById('balance').classList.add('bounce');
      setTimeout(() => {
        document.getElementById('balance').classList.remove('bounce');
      }, 500);
      saveData();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    function renderCalendar() {
      const calendar = document.getElementById('calendar');
      const today = new Date();
      const dayNames = ['–≤—Å', '–ø–Ω', '–≤—Ç', '—Å—Ä', '—á—Ç', '–ø—Ç', '—Å–±'];
      
      // –ù–∞—Ö–æ–¥–∏–º –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
      const currentDay = today.getDay();
      const monday = new Date(today);
      monday.setDate(today.getDate() - (currentDay === 0 ? 6 : currentDay - 1));
      
      calendar.innerHTML = '';
      
      for (let i = 0; i < 7; i++) {
        const date = new Date(monday);
        date.setDate(monday.getDate() + i);
        
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        
        const isPast = date < today && date.toDateString() !== today.toDateString();
        const isToday = date.toDateString() === today.toDateString();
        const isFuture = date > today;
        
        let dayClass = 'past';
        if (isToday) dayClass = 'today';
        if (isFuture) dayClass = 'future';
        
        dayEl.innerHTML = `
          <div class="day-name">${dayNames[date.getDay()]}</div>
          <div class="day-number ${dayClass}">${date.getDate()}</div>
        `;
        
        calendar.appendChild(dayEl);
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫
    function renderHabits() {
      const container = document.getElementById('habitsList');
      const categories = {};
      
      // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      data.habits.forEach(habit => {
        if (!categories[habit.category]) {
          categories[habit.category] = [];
        }
        categories[habit.category].push(habit);
      });
      
      container.innerHTML = '';
      
      Object.keys(categories).forEach(categoryName => {
        const categoryEl = document.createElement('div');
        categoryEl.className = 'category';
        
        const titleEl = document.createElement('div');
        titleEl.className = 'category-title';
        titleEl.textContent = categoryName;
        categoryEl.appendChild(titleEl);
        
        categories[categoryName].forEach(habit => {
          const habitEl = document.createElement('div');
          habitEl.className = 'habit-card';
          habitEl.style.setProperty('--habit-color', habit.color);
          
          const today = new Date().toDateString();
          const isCompleted = habit.lastCompleted === today;
          const plantIcon = habit.skips >= 3 ? 'ü•Ä' : plantStages[Math.min(habit.streak, 5)];
          
          habitEl.innerHTML = `
            <div class="habit-icon">${plantIcon}</div>
            <div class="habit-info">
              <div class="habit-name">${habit.name}</div>
              <div class="habit-reward">+${habit.reward} üåº</div>
            </div>
            <button class="habit-check ${isCompleted ? 'completed' : ''}" 
                    data-id="${habit.id}"
                    ${isCompleted ? 'disabled' : ''}>
              ${isCompleted ? '‚úì' : '‚óã'}
            </button>
          `;
          
          categoryEl.appendChild(habitEl);
        });
        
        container.appendChild(categoryEl);
      });
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
      document.querySelectorAll('.habit-check').forEach(btn => {
        btn.addEventListener('click', function() {
          const habitId = parseInt(this.dataset.id);
          completeHabit(habitId);
        });
      });
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
    function completeHabit(habitId) {
      const habit = data.habits.find(h => h.id === habitId);
      if (!habit) return;
      
      const today = new Date().toDateString();
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ - —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è?
      if (habit.lastCompleted === today) {
        return;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
      habit.lastCompleted = today;
      habit.streak++;
      habit.weekSkips = 0; // –°–±—Ä–æ—Å –ø—Ä–æ–ø—É—Å–∫–æ–≤ –Ω–µ–¥–µ–ª–∏
      
      // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã
      updateBalance(habit.reward);
      
      saveData();
      renderHabits();
      
      // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
      if (tg.HapticFeedback) {
        tg.HapticFeedback.impactOccurred('medium');
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–≤—ã–∑—ã–≤–∞—Ç—å —Ä–∞–∑ –≤ –¥–µ–Ω—å)
    function checkSkips() {
      const today = new Date().toDateString();
      
      data.habits.forEach(habit => {
        if (habit.lastCompleted !== today) {
          habit.weekSkips++;
          
          // –ï—Å–ª–∏ 3+ –ø—Ä–æ–ø—É—Å–∫–∞ –≤ –Ω–µ–¥–µ–ª—é - –ø–æ–∫–∞–∑–∞—Ç—å –°–ø—Ä–∏–Ω—Ç–∞
          if (habit.weekSkips >= 3 && habit.skips < 3) {
            showSprintModal();
            habit.skips++;
          }
        }
      });
      
      saveData();
    }

    // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª–∫–∏ –°–ø—Ä–∏–Ω—Ç–∞
    function showSprintModal() {
      const modal = document.getElementById('sprintModal');
      const message = document.getElementById('sprintMessage');
      
      const randomMessage = sprintMessages[Math.floor(Math.random() * sprintMessages.length)];
      message.textContent = randomMessage;
      
      modal.classList.add('show');
      
      if (tg.HapticFeedback) {
        tg.HapticFeedback.notificationOccurred('warning');
      }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
    document.getElementById('closeModal').addEventListener('click', () => {
      document.getElementById('sprintModal').classList.remove('show');
    });

    document.getElementById('sprintModal').addEventListener('click', (e) => {
      if (e.target.id === 'sprintModal') {
        document.getElementById('sprintModal').classList.remove('show');
      }
    });

    // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏
    let selectedColor = '#4CAF50';

    document.getElementById('addHabitBtn').addEventListener('click', () => {
      document.getElementById('habitForm').classList.add('show');
      document.getElementById('addHabitBtn').style.display = 'none';
    });

    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('habitForm').classList.remove('show');
      document.getElementById('addHabitBtn').style.display = 'block';
    });

    // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
    document.querySelectorAll('.color-option').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
        this.classList.add('selected');
        selectedColor = this.dataset.color;
      });
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
    document.getElementById('createBtn').addEventListener('click', () => {
      const name = document.getElementById('habitName').value.trim();
      const category = document.getElementById('habitCategory').value.trim() || '–î—Ä—É–≥–æ–µ';
      const reward = parseInt(document.getElementById('habitReward').value) || 5;
      
      if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏!');
        return;
      }
      
      const newHabit = {
        id: Date.now(),
        name,
        category,
        reward,
        color: selectedColor,
        streak: 0,
        lastCompleted: null,
        skips: 0,
        weekSkips: 0
      };
      
      data.habits.push(newHabit);
      saveData();
      
      // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
      document.getElementById('habitName').value = '';
      document.getElementById('habitCategory').value = '';
      document.getElementById('habitReward').value = '5';
      document.getElementById('habitForm').classList.remove('show');
      document.getElementById('addHabitBtn').style.display = 'block';
      
      renderHabits();
      
      if (tg.HapticFeedback) {
        tg.HapticFeedback.notificationOccurred('success');
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderCalendar();
    renderHabits();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    checkSkips();

    console.log('Sprint Mini App –∑–∞–≥—Ä—É–∂–µ–Ω ‚úÖ');
    console.log('User ID:', tg.initDataUnsafe?.user?.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
  </script>
</body>
</html>
